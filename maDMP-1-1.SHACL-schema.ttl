@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix :      <https://w3id.org/madmp/terms#> .
@prefix schema: <http://schema.org/> .
@prefix owl:   <http://www.w3.org/2002/07/owl#> .
@prefix ns:    <http://www.w3.org/2003/06/sw-vocab-status/ns#> .
@prefix dcam:  <http://purl.org/dc/dcam/> .
@prefix xsd:   <http://www.w3.org/2001/XMLSchema#> .
@prefix skos:  <http://www.w3.org/2004/02/skos/core#> .
@prefix dcsx:  <https://w3id.org/dcso/ns/extension#> .
@prefix rdfs:  <http://www.w3.org/2000/01/rdf-schema#> .
@prefix ex:    <https://w3id.org/dcso/id/example/> .
@prefix dct:   <http://purl.org/dc/terms/> .
@prefix rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix terms: <http://purl.org/dc/terms/> .
@prefix xml:   <http://www.w3.org/XML/1998/namespace> .
@prefix dcat:  <http://www.w3.org/ns/dcat#> .
@prefix vann:  <http://purl.org/vocab/vann/> .
@prefix wot:   <http://xmlns.com/wot/0.1/> .
@prefix prov:  <http://www.w3.org/ns/prov#> .
@prefix madmp: <https://w3id.org/madmp/terms#> .
@prefix foaf:  <http://xmlns.com/foaf/0.1/> .
@prefix dash: <http://datashapes.org/dash#> .

ex:DMPShape
    a sh:NodeShape;
    sh:name "The DMP Schema";
    sh:targetClass madmp:DMP;
    sh:property [
        sh:path terms:title;
        sh:name "The DMP Title Schema";
        sh:description "Title of a DMP";
        sh:minCount 1;
        sh:maxCount 1;
        sh:datatype xsd:string;
    ];
    sh:property [
        sh:path madmp:contact;
        sh:name "The DMP Contact Schema";
        sh:minCount 1;
        sh:maxCount 1;
        sh:property [
            sh:path madmp:contact_id;
            sh:name "The Contact ID Schema";
            sh:minCount 1;
            sh:maxCount 1;
            sh:property [
                sh:path terms:identifier;
                sh:name "The DMP Contact Identifier Schema";
                sh:minCount 1;
                sh:maxCount 1;
                sh:datatype xsd:string;
            ];
            sh:property [
                sh:path madmp:identifier_type;
                sh:name "The DMP Contact Identifier Type Schema";
                sh:description "Identifier type. Allowed values: orcid, isni, openid, other";
                sh:minCount 1;
                sh:maxCount 1;
                sh:in ("orcid"^^xsd:string "isni"^^xsd:string "openid"^^xsd:string "other"^^xsd:string);
            ];
        ];
        sh:property [
            sh:path foaf:mbox;
            sh:name "The Mailbox Schema";
            sh:description "Contact Person's E-mail address";
            sh:minCount 1;
            sh:maxCount 1;
            sh:pattern "^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$"
        ];
        sh:property [
            sh:path foaf:name;
            sh:name "The Name Schema";
            sh:description "Name of the contact person";
            sh:minCount 1;
            sh:maxCount 1;
            sh:datatype xsd:string;
        ];

    ];
    sh:property [
        sh:path madmp:contributor;
        sh:name "The Contributor Schema";
        sh:property [
            sh:path madmp:contributor_id;
            sh:name "The Contributor_id Schema";
            sh:minCount 1;
            sh:maxCount 1;
            sh:property [
                sh:path terms:identifier;
                sh:name "The Contributor Identifier Schema";
                sh:description "Identifier for a contact person";
                sh:minCount 1;
                sh:maxCount 1;
                sh:datatype xsd:string;
            ];
            sh:property [
                sh:path madmp:identifier_type;
                sh:name "The Contributor Identifier Type Schema";
                sh:description "Identifier type. Allowed values: orcid, isni, openid, other";
                sh:minCount 1;
                sh:maxCount 1;
                sh:in ("orcid"^^xsd:string "isni"^^xsd:string "openid"^^xsd:string "other"^^xsd:string );
            ];
        ];
        sh:property [
            sh:path foaf:mbox;
            sh:name "The Contributor Mailbox Schema";
            sh:description "Contributor Mail address";
            sh:maxCount 1;
            sh:pattern "^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$"
        ];
        sh:property [
            sh:path foaf:name;
            sh:name "The Name Schema";
            sh:description "Name of the contributor";
            sh:minCount 1;
            sh:maxCount 1;
            sh:datatype xsd:string;
        ];
        sh:property [
            sh:path madmp:role;
            sh:name "The Role Schema";
            sh:description "Type of contributor";
            sh:node dash:ListShape;
            sh:minCount 1 ;
            sh:property [
                sh:path ( [ sh:zeroOrMorePath rdf:rest ] rdf:first ) ;
                sh:datatype xsd:string ;
                sh:minCount 1 ;
            ]
        ];
        sh:sparql [
            sh:message "Contributor {?name} has role {?role} more than once ({?roleCount} times).";
            sh:prefixes (madmp: rdf: foaf:);
            sh:select """
            PREFIX madmp: <https://w3id.org/madmp/terms#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            prefix foaf:  <http://xmlns.com/foaf/0.1/>

            SELECT $this ?role ?name (COUNT(?role) AS ?roleCount)
            WHERE {
                $this $PATH ?contributor.
                ?contributor madmp:role/rdf:rest*/rdf:first ?role;
                foaf:name ?name
            }
            GROUP BY $this ?name ?role
            HAVING (?roleCount > 1)
            """
        ]
    ];
    sh:property [
        sh:path madmp:dataset;
        sh:name "The Dataset Schema";
        sh:minCount 1;
        sh:property [
            sh:path madmp:data_quality_assurance;
            sh:name "The Data Quality Assurance Schema";
            sh:description "Data Quality Assurance";
            sh:datatype xsd:string
        ];
        sh:property [
            sh:path madmp:dataset_id;
            sh:name "The Dataset ID Schema";
            sh:description "The Dataset ID Schema";
            sh:minCount 1;
            sh:maxCount 1;
            sh:property [
                sh:path terms:identifier;
                sh:name "The Dataset Identifier Schema";
                sh:description "Identifier for a dataset";
                sh:minCount 1;
                sh:maxCount 1;
                sh:datatype xsd:string
            ];
            sh:property [
                sh:path madmp:identifier_type;
                sh:name "The Dataset Identifier Type Schema";
                sh:description "Dataset identifier type. Allowed values: handle, doi, ark, url, other";
                sh:minCount 1;
                sh:maxCount 1;
                sh:datatype xsd:string;
                sh:in ( "handle"^^xsd:string "doi"^^xsd:string "ark"^^xsd:string "url"^^xsd:string "other"^^xsd:string );
            ]
        ];
        sh:property [
            sh:path terms:description;
            sh:name "The Dataset Description Schema";
            sh:description "Description is a property in both Dataset and Distribution, in compliance with W3C DCAT. In some cases these might be identical, but in most cases the Dataset represents a more abstract concept, while the distribution can point to a specific file.";
            sh:maxCount 1;
            sh:datatype xsd:string
        ];
        sh:property [
            sh:path madmp:distribution;
            sh:name "The Dataset Distribution Schema";
            sh:description "To provide technical information on a specific instance of data.";
            sh:property [
                sh:path dcat:accessUrl;
                sh:name "The Dataset Distribution Access URL Schema";
                sh:description "A URL of the resource that gives access to a distribution of the dataset. e.g. landing page.";
                sh:maxCount 1;
                sh:datatype xsd:string;
            ];
            sh:property [
                sh:path madmp:available_until;
                sh:name "The Dataset Distribution Available Until Schema";
                sh:description "Indicates how long this distribution will be/ should be available. Encoded using the relevant ISO 8601 Date and Time compliant string.";
                sh:maxCount 1;
                sh:datatype xsd:string;
                sh:pattern "^\\d{4}-(0[1-9]|1[012])-([012]\\d|3[01])(T([01]\\d|2[012])(:[0-5]\\d){2}(\\.(\\d){1,3}(Z)?)?)?$"
            ];
            sh:property [
                sh:path dcat:byteSize;
                sh:name "The Dataset Distribution Byte Size Schema";
                sh:description "Size in bytes.";
                sh:maxCount 1;
                sh:datatype xsd:integer
            ];
            sh:property [
                sh:path madmp:data_access;
                sh:name "The Dataset Distribution Data Access Schema";
                sh:description "Indicates access mode for data. Allowed values: open, shared, closed";
                sh:minCount 1;
                sh:maxCount 1;
                sh:datatype xsd:string;
                sh:in ( "open"^^xsd:string "shared"^^xsd:string "closed"^^xsd:string)
            ];
            sh:property [
                sh:path terms:description;
                sh:name "The Dataset Distribution Description Schema";
                sh:description "Description is a property in both Dataset and Distribution, in compliance with W3C DCAT. In some cases these might be identical, but in most cases the Dataset represents a more abstract concept, while the distribution can point to a specific file.";
                sh:maxCount 1;
                sh:datatype xsd:string
            ];
            sh:property [
                sh:path dcat:downloadURL;
                sh:name "The Dataset Distribution Download URL Schema";
                sh:description "The URL of the downloadable file in a given format. E.g. CSV file or RDF file.";
                sh:maxCount 1;
                sh:datatype xsd:string;
                sh:pattern "^\\w+:(\\/){0,2}[^\\s]+$"
            ];
            sh:property [
                sh:path terms:format;
                sh:name "The Dataset Distribution Format Schema";
                sh:description "Format according to: https://www.iana.org/assignments/media-types/media-types.xhtml if appropriate, otherwise use the common name for this format.";
                sh:datatype xsd:string
            ];
            sh:property [
                sh:path madmp:hasHost;
                sh:name "The Dataset Distribution Host Schema";
                sh:description "To provide information on quality of service provided by infrastructure (e.g. repository) where data is stored.";
                sh:maxCount 1;
                sh:property [
                    sh:path madmp:availability;
                    sh:name "The Dataset Distribution Host Availability Schema";
                    sh:description "Availability";
                    sh:maxCount 1;
                    sh:datatype xsd:string
                ];
                sh:property [
                    sh:path madmp:backup_frequency;
                    sh:name "The Dataset Distribution Host Backup Frequency Schema";
                    sh:description "Backup Frequency";
                    sh:maxCount 1;
                    sh:datatype xsd:string
                ];
                sh:property [
                    sh:path madmp:backup_type;
                    sh:name "The Dataset Distribution Host Backup Type Schema";
                    sh:description "Backup Type";
                    sh:maxCount 1;
                    sh:datatype xsd:string
                ];
                sh:property [
                    sh:path madmp:certified_with;
                    sh:name "The Dataset Distribution Host Certification Type Schema";
                    sh:description "Repository certified to a recognised standard. Allowed values: din31644, dini-zertifikat, dsa, iso16363, iso16919, trac, wds, coretrustseal";
                    sh:maxCount 1;
                    sh:datatype xsd:string;
                    sh:in ( "din31644"^^xsd:string "dini-zertifikat"^^xsd:string "dsa"^^xsd:string "iso16363"^^xsd:string "iso16919"^^xsd:string "trac"^^xsd:string "wds"^^xsd:string "coretrustseal"^^xsd:string )
                ];
                sh:property [
                    sh:path terms:description;
                    sh:name "The Dataset Distribution Host Description Schema";
                    sh:description "Description";
                    sh:maxCount 1;
                    sh:datatype xsd:string
                ];
                sh:property [
                    sh:path madmp:geo_location;
                    sh:name "The Dataset Distribution Host Geographical Location Schema";
                    sh:description "Physical location of the data expressed using ISO 3166-1 country code.";
                    sh:maxCount 1;
                    sh:datatype xsd:string;
                    sh:in ( "AD"^^xsd:string "AE"^^xsd:string "AF"^^xsd:string "AG"^^xsd:string "AI"^^xsd:string "AL"^^xsd:string "AM"^^xsd:string "AO"^^xsd:string "AQ"^^xsd:string "AR"^^xsd:string "AS"^^xsd:string "AT"^^xsd:string "AU"^^xsd:string "AW"^^xsd:string "AZ"^^xsd:string "BA"^^xsd:string "BB"^^xsd:string "BD"^^xsd:string "BE"^^xsd:string "BF"^^xsd:string "BG"^^xsd:string "BH"^^xsd:string "BI"^^xsd:string "BJ"^^xsd:string "BL"^^xsd:string "BM"^^xsd:string "BN"^^xsd:string "BO"^^xsd:string "BQ"^^xsd:string "BR"^^xsd:string "BT"^^xsd:string "BV"^^xsd:string "BW"^^xsd:string "BY"^^xsd:string "BZ"^^xsd:string "CA"^^xsd:string "CC"^^xsd:string "CD"^^xsd:string "CF"^^xsd:string "CG"^^xsd:string "CH"^^xsd:string "CI"^^xsd:string "CK"^^xsd:string "CL"^^xsd:string "CM"^^xsd:string "CN"^^xsd:string "CR"^^xsd:string "CU"^^xsd:string "CV"^^xsd:string "CW"^^xsd:string "CX"^^xsd:string "CY"^^xsd:string "CZ"^^xsd:string "DE"^^xsd:string "DJ"^^xsd:string "DK"^^xsd:string "DM"^^xsd:string "DO"^^xsd:string "DZ"^^xsd:string "EC"^^xsd:string "EE"^^xsd:string "EG"^^xsd:string "ER"^^xsd:string "ES"^^xsd:string "ET"^^xsd:string "FI"^^xsd:string "FJ"^^xsd:string "FK"^^xsd:string "FM"^^xsd:string "FO"^^xsd:string "FR"^^xsd:string "GA"^^xsd:string "GB"^^xsd:string "GD"^^xsd:string "GE"^^xsd:string "GF"^^xsd:string "GG"^^xsd:string "GH"^^xsd:string "GL"^^xsd:string "GM"^^xsd:string "GN"^^xsd:string "GP"^^xsd:string "GQ"^^xsd:string "GR"^^xsd:string "GS"^^xsd:string "GT"^^xsd:string "GU"^^xsd:string "GW"^^xsd:string "GY"^^xsd:string "HK"^^xsd:string "HM"^^xsd:string "HN"^^xsd:string "HR"^^xsd:string "HT"^^xsd:string "ID"^^xsd:string "IE"^^xsd:string "IL"^^xsd:string "IM"^^xsd:string "IN"^^xsd:string "IO"^^xsd:string "IQ"^^xsd:string "IR"^^xsd:string "IS"^^xsd:string "IT"^^xsd:string "JE"^^xsd:string "JM"^^xsd:string "JO"^^xsd:string "JP"^^xsd:string "KE"^^xsd:string "KG"^^xsd:string "KI"^^xsd:string "KM"^^xsd:string "KN"^^xsd:string "KP"^^xsd:string "KR"^^xsd:string "KW"^^xsd:string "KY"^^xsd:string "KZ"^^xsd:string "LA"^^xsd:string "LB"^^xsd:string "LC"^^xsd:string "LI"^^xsd:string "LK"^^xsd:string "LR"^^xsd:string "LS"^^xsd:string "LT"^^xsd:string "LV"^^xsd:string "LY"^^xsd:string "MA"^^xsd:string "MC"^^xsd:string "MD"^^xsd:string "ME"^^xsd:string "MF"^^xsd:string "MG"^^xsd:string "MH"^^xsd:string "MK"^^xsd:string "ML"^^xsd:string "MM"^^xsd:string "MN"^^xsd:string "MO"^^xsd:string "MP"^^xsd:string "MQ"^^xsd:string "MS"^^xsd:string "MT"^^xsd:string "MU"^^xsd:string "MV"^^xsd:string "MW"^^xsd:string "MX"^^xsd:string "MY"^^xsd:string "MZ"^^xsd:string "NA"^^xsd:string "NC"^^xsd:string "NE"^^xsd:string "NF"^^xsd:string "NG"^^xsd:string "NI"^^xsd:string "NL"^^xsd:string "NO"^^xsd:string "NR"^^xsd:string "NU"^^xsd:string "NZ"^^xsd:string "OM"^^xsd:string "PA"^^xsd:string "PE"^^xsd:string "PF"^^xsd:string "PG"^^xsd:string "PH"^^xsd:string "PK"^^xsd:string "PL"^^xsd:string "PM"^^xsd:string "PN"^^xsd:string "PR"^^xsd:string "PS"^^xsd:string "PT"^^xsd:string "PY"^^xsd:string "QA"^^xsd:string "RE"^^xsd:string "RO"^^xsd:string "RS"^^xsd:string "RU"^^xsd:string "RW"^^xsd:string "SA"^^xsd:string "SB"^^xsd:string "SC"^^xsd:string "SD"^^xsd:string "SE"^^xsd:string "SG"^^xsd:string "SH"^^xsd:string "SI"^^xsd:string "SJ"^^xsd:string "SL"^^xsd:string "SM"^^xsd:string "SN"^^xsd:string "SO"^^xsd:string "SR"^^xsd:string "SS"^^xsd:string "ST"^^xsd:string "SV"^^xsd:string "SX"^^xsd:string "SY"^^xsd:string "SZ"^^xsd:string "TC"^^xsd:string "TD"^^xsd:string "TF"^^xsd:string "TG"^^xsd:string "TH"^^xsd:string "TK"^^xsd:string "TL"^^xsd:string "TM"^^xsd:string "TN"^^xsd:string "TO"^^xsd:string "TR"^^xsd:string "TT"^^xsd:string "TV"^^xsd:string "TW"^^xsd:string "TZ"^^xsd:string "UA"^^xsd:string "UG"^^xsd:string "UM"^^xsd:string "US"^^xsd:string "UY"^^xsd:string "UZ"^^xsd:string "VC"^^xsd:string "VE"^^xsd:string "VG"^^xsd:string "VI"^^xsd:string "VN"^^xsd:string "VU"^^xsd:string "WF"^^xsd:string "WS"^^xsd:string "YE"^^xsd:string "YT"^^xsd:string "ZA"^^xsd:string "ZM"^^xsd:string "ZW"^^xsd:string )
                ];
                sh:property [
                    sh:path madmp:pid_system;
                    sh:name "The Dataset Distribution Host PID System Schema";
                    sh:description "PID system(s). Allowed values: ark, arxiv, bibcode, doi, ean13, eissn, handle, igsn, isbn, issn, istc, lissn, lsid, pmid, purl, upc, url, urn, other";
                    sh:datatype xsd:string;
                    sh:in ( "ark"^^xsd:string "arxiv"^^xsd:string "bibcode"^^xsd:string "doi"^^xsd:string "ean13"^^xsd:string "eissn"^^xsd:string "handle"^^xsd:string "igsn"^^xsd:string "isbn"^^xsd:string "issn"^^xsd:string "istc"^^xsd:string "lissn"^^xsd:string "lsid"^^xsd:string "pmid"^^xsd:string "purl"^^xsd:string "upc"^^xsd:string "url"^^xsd:string "urn"^^xsd:string "other"^^xsd:string )
                ];
                sh:property [
                    sh:path madmp:storage_type;
                    sh:name "The Dataset Distribution Host Storage Type Schema";
                    sh:description "The type of storage required";
                    sh:maxCount 1;
                    sh:datatype xsd:string
                ];
                sh:property [
                    sh:path madmp:support_versioning;
                    sh:name "The Dataset Distribution Host Support Versioning Schema";
                    sh:description "If host supports versioning. Allowed values: yes, no, unknown";
                    sh:maxCount 1;
                    sh:datatype xsd:string;
                    sh:in ( "yes"^^xsd:string "no"^^xsd:string "unknown"^^xsd:string)
                ];
                sh:property [
                    sh:path terms:title;
                    sh:name "The Dataset Distribution Host Title Schema";
                    sh:description "Title";
                    sh:minCount 1;
                    sh:maxCount 1;
                    sh:datatype xsd:string
                ];
                sh:property [
                    sh:path madmp:url;
                    sh:name "The Dataset Distribution Host URL Schema";
                    sh:description "The URL of the system hosting a distribution of a dataset";
                    sh:minCount 1;
                    sh:maxCount 1;
                    sh:datatype xsd:string;
                    sh:pattern "^\\w+:(\\/){0,2}[^\\s]+$"
                ]
            ];

        ];

    ];
    sh:property [
        sh:path terms:title;
        sh:name "The DMP Title Schema";
        sh:description "Title of a DMP";
        sh:minCount 1;
        sh:maxCount 1;
        sh:datatype xsd:string;
    ].